bd_final <- base2
accidentes_mes_ano <- bd_final %>% group_by(FECHA) %>%
dplyr::summarize(numero_de_accidentes = n())
accidentes_mes_ano$ano <- year(accidentes_mes_ano$FECHA)
accidentes_mes_ano$mes <- month(accidentes_mes_ano$FECHA)
aggregate(numero_de_accidentes~ano*mes, data = accidentes_mes_ano, FUN = mean) %>%
plot_ly(x = ~mes,
y = ~numero_de_accidentes, type = "scatter", mode = "lines+markers",
split = ~ano, line = list(width = 1.5)) %>%
layout(title = 'Promedio accidentes mensuales por año',
xaxis = list(title = "Mes"),
yaxis = list(title = "Número de accidentes"))
accidentes_semana <- bd_final %>%
group_by(DIA_SEMANA) %>%
summarise(numero_de_accidentes = n())
accidentes_semana$DIA_SEMANA <- ordered(accidentes_semana$DIA_SEMANA, levels = c("lunes","martes","miércoles","jueves","viernes","sábado","domingo"))
grafico_dia_semana <- ggplot(accidentes_semana, aes(fill = DIA_SEMANA, x = DIA_SEMANA, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Día") +
ylab("Número de accidentes ") +
ggtitle("Número de accidentes por día de la semana") +
ylim(c(0,45000)) +
theme(plot.title = element_text(hjust = 0.5))+
guides(fill = guide_legend(title = "Día de la semana"))+
scale_fill_brewer(palette = "Set2")
grafico_dia_semana
accidentes_mes <- bd_final %>%
group_by(MES) %>%
summarise(numero_de_accidentes = n())
accidentes_mes$MES <- gsub("1","Enero",accidentes_mes$MES)
accidentes_mes$MES <- gsub("2","Febrero",accidentes_mes$MES)
accidentes_mes$MES <- gsub("3","Marzo",accidentes_mes$MES)
accidentes_mes$MES <- gsub("4","Abril",accidentes_mes$MES)
accidentes_mes$MES <- gsub("5","Mayo",accidentes_mes$MES)
accidentes_mes$MES <- gsub("6","Junio",accidentes_mes$MES)
accidentes_mes$MES <- gsub("7","Julio",accidentes_mes$MES)
accidentes_mes$MES <- gsub("8","Agosto",accidentes_mes$MES)
accidentes_mes$MES <- gsub("9","Septiembre",accidentes_mes$MES)
accidentes_mes$MES <- gsub("Enero0","Octubre",accidentes_mes$MES)
accidentes_mes$MES <- gsub("EneroEnero","Noviembre",accidentes_mes$MES)
accidentes_mes$MES <- gsub("EneroFebrero","Diciembre",accidentes_mes$MES)
accidentes_mes$MES <- ordered(accidentes_mes$MES, levels = c("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"))
ggplot(data = accidentes_mes, aes(fill=MES, x = MES, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
scale_fill_hue() +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Mes") +
ylab("Número de accidentes") +
ylim(c(0,26000)) +
ggtitle("Número de accidentes por mes")+
theme(plot.title = element_text(hjust = 0.5),axis.text.x = element_text(angle = 90, hjust = 0))
accidente_año <- table(bd_final$ANO) %>%
as.data.frame()
ggplot(data = accidente_año, aes(fill = Var1, x = Var1, y = Freq)) +
geom_bar(stat = "identity") +
geom_text(aes(y = Freq, label = Freq), vjust = -0.5) +
scale_fill_brewer(palette = "Set2") +
xlab("Año") +
ylab("Número de accidentes") +
ylim(c(0,50000)) +
ggtitle("Número de accidentes por año")+
theme(plot.title = element_text(hjust = 0.5))+
guides(fill = guide_legend(title = "Año"))
accidentes_comuna <- bd_final %>%
group_by(COMUNA) %>%
dplyr::summarize(numero_de_accidentes = n())
ggplot(data = accidentes_comuna, aes( fill = COMUNA, x = reorder(COMUNA,+numero_de_accidentes), y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
scale_fill_viridis_d( option = "C") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), hjust = -0.1) +
xlab("Comuna") +
ylab("Número de accidentes") +
ggtitle("Número de accidentes por comuna") +
ylim(c(0,60000)) +
coord_flip() +
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
accidentes_gravedad <- bd_final %>%
group_by(GRAVEDAD) %>%
summarise(numero_de_accidentes = n())
ggplot(data = accidentes_gravedad, aes(fill = GRAVEDAD, x = GRAVEDAD, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,150000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
accidentes_tipo_festividad <- bd_final %>%
group_by(TIPO_FESTIVIDAD) %>%
summarise(numero_de_accidentes = n())
accidentes_tipo_festividad <- accidentes_tipo_festividad[c(1,2,4,5,6),]
accidentes_tipo_festividad$TIPO_FESTIVIDAD <- gsub("A_NUEVO","AÑO NUEVO",accidentes_tipo_festividad$TIPO_FESTIVIDAD)
accidentes_tipo_festividad$TIPO_FESTIVIDAD <- gsub("SEM_SANTA","SEMANA SANTA",accidentes_tipo_festividad$TIPO_FESTIVIDAD)
accidentes_tipo_festividad$TIPO_FESTIVIDAD <- gsub("MADRES","DIA DE LAS MADRES",accidentes_tipo_festividad$TIPO_FESTIVIDAD)
accidentes_tipo_festividad$TIPO_FESTIVIDAD <- gsub("BRUJAS","HALLOWEEN",accidentes_tipo_festividad$TIPO_FESTIVIDAD)
ggplot(data = accidentes_tipo_festividad, aes(fill = TIPO_FESTIVIDAD, x = TIPO_FESTIVIDAD, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Tipo de festividad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por tipo de festividad") +
ylim(c(0,5000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
accidentes_festividad <- bd_final %>%
group_by(FESTIVIDAD) %>%
summarise(numero_de_accidentes = n())
ggplot(data = accidentes_festividad, aes(fill = FESTIVIDAD, x = FESTIVIDAD, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Festivo") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes en días feriados") +
ylim(c(0,250000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
# Lectura de la base de datos
bd_depurada <- read.csv("./datos/base_depurada.csv", dec=".", header=T,sep=",")
bd_depurada$CLASE <- as.factor(as.character(bd_depurada$CLASE))
# Division en train y val
datos_val_2019 <- subset(bd_depurada, (ANO == '2019'))
datos_val_2020 <- subset(bd_depurada, (ANO == '2020'))
base_train <- subset(bd_depurada, (ANO != '2019' & ANO != '2020'))
#Modelo lineal
datos_lm1_tr <- base_train %>% group_by(FECHA, FESTIVIDAD,
DIA_SEMANA) %>% count(name = "NRO_ACCID")
#Modelo lineal
datos_lm1_tr <- base_train %>% group_by(FECHA, FESTIVIDAD,
DIA_SEMANA) %>% count(name = "NRO_ACCID")
knitr::opts_chunk$set(echo = TRUE)
# Librerias
library(stringr)
library(dplyr)
library(rgdal)
library(tidyverse)
library(kableExtra)
library(lubridate)
library(ggplot2)
library(plotly)
library(ggpubr)
library(dummies)
library(readxl)
library(sf)
library(GGally)
library(car)
library(MLmetrics)
library(wordcloud)
library(gplots)
library(R.utils)
library(tm)
library(DescTools)
library(raster)
library(mclust)
library(geosphere)
library(NbClust)
library(factoextra)
library(vegan)
library(qpcR)
library(leaflet)
#Lectura de la base de datos
bd <- read.csv("./datos/incidentes_viales.csv", dec=",", header=T,sep=";")
#Mostramos las primeras 5 observaciones de la base de datos
head(bd,n=5)
#Se cambia el formata de la fecha del accidente
bd$FECHA_ACCIDENTE <- as.Date(bd$FECHA_ACCIDENTE, format="%d/%m/%Y")
#Revisamos que variables contienen valores vacios
colSums(is.na(bd)|bd=="")
# reemplazamos los datos vacios de la variable CLASE_ACCIDENTE
#Cambiar los datos vacios por "otro".
bd$CLASE_ACCIDENTE <- ifelse(bd$CLASE_ACCIDENTE == "","Otro",bd$CLASE_ACCIDENTE)
#Correcion de tildes
bd$CLASE_ACCIDENTE <- iconv(bd$CLASE_ACCIDENTE, from = "UTF-8", to = "ASCII//TRANSLIT")
# Cambiar datos vacios de la variable DISENO
#Cambiar datos vacios por "no especificado"
bd$DISENO <- ifelse(bd$DISENO == "","otro",bd$DISENO)
#Correccion de tildes
bd$DISENO <- iconv(bd$DISENO, from = "UTF-8",to="ASCII//TRANSLIT")
#Creamos una nueva variables que contiene el dia de la semana en que ocurrio el accidente
bd$DIA_SEMANA <- format(bd$FECHA_ACCIDENTE, format="%A")
#Creamos una nueva variables la cual contiene la hora del accidente
bd$HORA_ACCIDENTE <- substr(bd$FECHA_ACCIDENTES,start = 12 ,stop = 19)
catastro <- rgdal::readOGR(dsn = "./datos/Catastro_gdb.shp", layer = "Catastro_gdb")
#quitamos los 962 datos de CBML que están errados ---> quedan 269803
bd <- bd[-which(bd$CBML %in% c("AUC1","AUC2","Inst_14","Inst_16","Inst_18","Inst_19","Sin Inf","SN01")),]
#Creamos un nueva columna llamada CB en bd que solo deja los primeros 4 digitos de CBML para buscarlos en la bd de catastro y traer la comuna y el barrio de los que estén vacios.
bd <- mutate(bd, TEMP_CBML = str_sub(CBML,1,4))
#agregando un cero adelante a los TEMP_CBML y creando una nueva columna --> TEMP2_CBML
bd <- mutate(bd, TEMP2_CBML=ifelse(nchar(TEMP_CBML)==3,paste0("0", TEMP_CBML),TEMP_CBML),TEMP_CBML)
colnames(bd)#nombres de columnas
#base unificada
bd <- inner_join(bd, dplyr::select(catastro@data,CODIGO,NOMBRE_COM,NOMBRE_BAR),
by = c("TEMP2_CBML" = "CODIGO")) #quedan 254009 datos
#Quitar repetidos por el inner_join
bd <- bd %>%     #convirtiendo en factor para ver mejor los únicos
mutate(NRO_RADICADO = as.factor(NRO_RADICADO))
radicados_duplicados <- bd$NRO_RADICADO[duplicated(bd$NRO_RADICADO)]
radicados_duplicados  #verificar duplicados
registros_rad_dup <- bd %>%
filter(NRO_RADICADO %in% radicados_duplicados) %>%  #
arrange(NRO_RADICADO)
#registros_rad_dup
bd_unif <- bd %>%
filter(!(NRO_RADICADO %in% radicados_duplicados))
#246417 observaciones únicas
#Eliminacion de variables no necesarias
base2 <- dplyr::select(bd_unif,-X,-Y,-BARRIO,-COMUNA,-DIRECCION.ENCASILLADA,-CBML,-TEMP_CBML,-TEMP2_CBML,-FECHA_ACCIDENTES,-EXPEDIENTE,-NRO_RADICADO)
#Correccion de tildes
base2$NOMBRE_BAR <- iconv(base2$NOMBRE_BAR, from = "UTF-8", to = "ASCII//TRANSLIT")
#separar en dos nuevas variables la longitud y latitud, contenidos en la variables LOCATION
base2 <- separate(base2,LOCATION,c("LONGITUD","LATITUD"),sep=",",convert=TRUE)
#quitamos el "[" del dato
base2$LONGITUD <- substring(base2$LONGITUD, first = 2)
#Eliminar el espacio entre los numeros
base2$LATITUD <- gsub(" ","", base2$LATITUD)
#eliminar el ultimo elemento "]"
base2$LATITUD <- gsub("]","", base2$LATITUD)
#renombraremos las variables
base2 <- plyr::rename(base2,  c("FECHA_ACCIDENTE"="FECHA","NOMBRE_BAR"="BARRIO","NOMBRE_COM"="COMUNA","GRAVEDAD_ACCIDENTE"="GRAVEDAD","CLASE_ACCIDENTE"="CLASE"))
fechas_especiales <- read.csv("./datos/dias_festivos.csv", sep = ",", header = T)
class(fechas_especiales$FECHA)
fechas_especiales$FECHA <- as.Date(fechas_especiales$FECHA, format="%d/%m/%Y")
class(fechas_especiales$FECHA)
#unimos las fechas especiales a la base de datos
base2 <- merge(x = base2, y = fechas_especiales, by = "FECHA", all.x = T)
base2$FESTIVIDAD <- ifelse(is.na(base2$FESTIVIDAD),"NO","SI")
base2$FESTIVIDAD <- as.factor(base2$FESTIVIDAD)
summary(base2$FESTIVIDAD)
#agregando semana
base2 <- mutate(base2, SEMANA=as.factor(week(base2$FECHA)))
base2$SEMANA <- as.factor(base2$SEMANA)
#Tipo de festividad
fechas_especiales2 <- read.csv("./datos/dias_festivos_2.csv",
sep = ",",
header = T)
#convertir a date
fechas_especiales2$FECHA <- as.Date(fechas_especiales2$FECHA, format="%d/%m/%Y")#año,mes,dia
class(base2$FECHA)
class(fechas_especiales2$FECHA)
base2 <- left_join(base2, dplyr::select(fechas_especiales2,FECHA,TIPO_FESTIVIDAD),
by = c("FECHA" = "FECHA"))
base2$TIPO_FESTIVIDAD <- factor(base2$TIPO_FESTIVIDAD, levels = c("A_NUEVO","BRUJAS","FESTIVO","MADRES","NAVIDAD","SEM_SANTA","No_festivo"))
base2$TIPO_FESTIVIDAD[is.na(base2$TIPO_FESTIVIDAD)] <- "No_festivo"
base2$TIPO_FESTIVIDAD <- as.factor(base2$TIPO_FESTIVIDAD)
#EJECUTAR SOLO PARA CREAR EL CSV NUEVO
#write.csv(base2,"./datos/base_depurada.csv",fileEncoding = "UTF-8")
head(base2,n=5)
bd_final <- base2
accidentes_mes_ano <- bd_final %>% group_by(FECHA) %>%
dplyr::summarize(numero_de_accidentes = n())
accidentes_mes_ano$ano <- year(accidentes_mes_ano$FECHA)
accidentes_mes_ano$mes <- month(accidentes_mes_ano$FECHA)
aggregate(numero_de_accidentes~ano*mes, data = accidentes_mes_ano, FUN = mean) %>%
plot_ly(x = ~mes,
y = ~numero_de_accidentes, type = "scatter", mode = "lines+markers",
split = ~ano, line = list(width = 1.5)) %>%
layout(title = 'Promedio accidentes mensuales por año',
xaxis = list(title = "Mes"),
yaxis = list(title = "Número de accidentes"))
accidentes_semana <- bd_final %>%
group_by(DIA_SEMANA) %>%
summarise(numero_de_accidentes = n())
accidentes_semana$DIA_SEMANA <- ordered(accidentes_semana$DIA_SEMANA, levels = c("lunes","martes","miércoles","jueves","viernes","sábado","domingo"))
grafico_dia_semana <- ggplot(accidentes_semana, aes(fill = DIA_SEMANA, x = DIA_SEMANA, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Día") +
ylab("Número de accidentes ") +
ggtitle("Número de accidentes por día de la semana") +
ylim(c(0,45000)) +
theme(plot.title = element_text(hjust = 0.5))+
guides(fill = guide_legend(title = "Día de la semana"))+
scale_fill_brewer(palette = "Set2")
grafico_dia_semana
accidentes_mes <- bd_final %>%
group_by(MES) %>%
summarise(numero_de_accidentes = n())
accidentes_mes$MES <- gsub("1","Enero",accidentes_mes$MES)
accidentes_mes$MES <- gsub("2","Febrero",accidentes_mes$MES)
accidentes_mes$MES <- gsub("3","Marzo",accidentes_mes$MES)
accidentes_mes$MES <- gsub("4","Abril",accidentes_mes$MES)
accidentes_mes$MES <- gsub("5","Mayo",accidentes_mes$MES)
accidentes_mes$MES <- gsub("6","Junio",accidentes_mes$MES)
accidentes_mes$MES <- gsub("7","Julio",accidentes_mes$MES)
accidentes_mes$MES <- gsub("8","Agosto",accidentes_mes$MES)
accidentes_mes$MES <- gsub("9","Septiembre",accidentes_mes$MES)
accidentes_mes$MES <- gsub("Enero0","Octubre",accidentes_mes$MES)
accidentes_mes$MES <- gsub("EneroEnero","Noviembre",accidentes_mes$MES)
accidentes_mes$MES <- gsub("EneroFebrero","Diciembre",accidentes_mes$MES)
accidentes_mes$MES <- ordered(accidentes_mes$MES, levels = c("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"))
ggplot(data = accidentes_mes, aes(fill=MES, x = MES, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
scale_fill_hue() +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Mes") +
ylab("Número de accidentes") +
ylim(c(0,26000)) +
ggtitle("Número de accidentes por mes")+
theme(plot.title = element_text(hjust = 0.5),axis.text.x = element_text(angle = 90, hjust = 0))
accidente_año <- table(bd_final$ANO) %>%
as.data.frame()
ggplot(data = accidente_año, aes(fill = Var1, x = Var1, y = Freq)) +
geom_bar(stat = "identity") +
geom_text(aes(y = Freq, label = Freq), vjust = -0.5) +
scale_fill_brewer(palette = "Set2") +
xlab("Año") +
ylab("Número de accidentes") +
ylim(c(0,50000)) +
ggtitle("Número de accidentes por año")+
theme(plot.title = element_text(hjust = 0.5))+
guides(fill = guide_legend(title = "Año"))
accidentes_comuna <- bd_final %>%
group_by(COMUNA) %>%
dplyr::summarize(numero_de_accidentes = n())
ggplot(data = accidentes_comuna, aes( fill = COMUNA, x = reorder(COMUNA,+numero_de_accidentes), y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
scale_fill_viridis_d( option = "C") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), hjust = -0.1) +
xlab("Comuna") +
ylab("Número de accidentes") +
ggtitle("Número de accidentes por comuna") +
ylim(c(0,60000)) +
coord_flip() +
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
accidentes_gravedad <- bd_final %>%
group_by(GRAVEDAD) %>%
summarise(numero_de_accidentes = n())
ggplot(data = accidentes_gravedad, aes(fill = GRAVEDAD, x = GRAVEDAD, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,150000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
accidentes_tipo_festividad <- bd_final %>%
group_by(TIPO_FESTIVIDAD) %>%
summarise(numero_de_accidentes = n())
accidentes_tipo_festividad <- accidentes_tipo_festividad[c(1,2,4,5,6),]
accidentes_tipo_festividad$TIPO_FESTIVIDAD <- gsub("A_NUEVO","AÑO NUEVO",accidentes_tipo_festividad$TIPO_FESTIVIDAD)
accidentes_tipo_festividad$TIPO_FESTIVIDAD <- gsub("SEM_SANTA","SEMANA SANTA",accidentes_tipo_festividad$TIPO_FESTIVIDAD)
accidentes_tipo_festividad$TIPO_FESTIVIDAD <- gsub("MADRES","DIA DE LAS MADRES",accidentes_tipo_festividad$TIPO_FESTIVIDAD)
accidentes_tipo_festividad$TIPO_FESTIVIDAD <- gsub("BRUJAS","HALLOWEEN",accidentes_tipo_festividad$TIPO_FESTIVIDAD)
ggplot(data = accidentes_tipo_festividad, aes(fill = TIPO_FESTIVIDAD, x = TIPO_FESTIVIDAD, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Tipo de festividad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por tipo de festividad") +
ylim(c(0,5000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
accidentes_festividad <- bd_final %>%
group_by(FESTIVIDAD) %>%
summarise(numero_de_accidentes = n())
ggplot(data = accidentes_festividad, aes(fill = FESTIVIDAD, x = FESTIVIDAD, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Festivo") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes en días feriados") +
ylim(c(0,250000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
# Lectura de la base de datos
bd_depurada <- read.csv("./datos/base_depurada.csv", dec=".", header=T,sep=",")
bd_depurada$CLASE <- as.factor(as.character(bd_depurada$CLASE))
# Division en train y val
datos_val_2019 <- subset(bd_depurada, (ANO == '2019'))
datos_val_2020 <- subset(bd_depurada, (ANO == '2020'))
base_train <- subset(bd_depurada, (ANO != '2019' & ANO != '2020'))
#Modelo lineal
datos_lm1_tr <- base_train %>% group_by(FECHA, FESTIVIDAD,
DIA_SEMANA) %>% count(name = "NRO_ACCID")
# lm1 <- lm(NRO_ACCID ~ FESTIVIDAD+DIA_SEMANA, data = datos_lm1_tr)
lm1 <- glm(NRO_ACCID ~ FESTIVIDAD+DIA_SEMANA, family = "poisson", data = datos_lm1_tr)
# Evaluacion modelo 1
datos_lm1_tr_pred <- datos_lm1_tr[,-c(4)]
predicted <- round(predict(lm1, newdata=datos_lm1_tr_pred, type="response"))
actual <- datos_lm1_tr$NRO_ACCID
lm1_tr_mse <- MSE(predicted, actual) # MSE
lm1_tr_mae <- MAE(predicted, actual) # MAE
lm1_tr_r2 <- R2_Score(predicted, actual) # R2
sprintf("MSE: %f, MAE: %f, R2: %f", lm1_tr_mse, lm1_tr_mae, lm1_tr_r2)
datos_lm1_val <- datos_val_2019 %>% group_by(FECHA, FESTIVIDAD,
DIA_SEMANA) %>% count(name = "NRO_ACCID")
datos_lm1_val_pred <- datos_lm1_val[,-c(4)]
predicted <- round(predict(lm1, newdata=datos_lm1_val_pred, type="response"))
actual <- datos_lm1_val$NRO_ACCID
lm1_val_mse <- MSE(predicted, actual) # MSE
lm1_val_mae <- MAE(predicted, actual) # MAE
lm1_val_r2 <- R2_Score(predicted, actual) # R2
sprintf("MSE: %f, MAE: %f, R2: %f", lm1_val_mse, lm1_val_mae, lm1_val_r2)
mae_variation = function(mae_tr, mae_val){
variacion = mae_tr - mae_vl
porcentaje = variacion / mae_tr
porcentaje * 100 * -1
}
mae_tr = lm1_tr_mae
mae_vl = lm1_val_mae
print(mae_variation(mae_tr, mae_val))
datos_lm1_val <- datos_val_2020 %>% group_by(FECHA, FESTIVIDAD,
DIA_SEMANA) %>% count(name = "NRO_ACCID")
datos_lm1_val_pred <- datos_lm1_val[,-c(4)]
predicted <- round(predict(lm1, newdata=datos_lm1_val_pred, type="response"))
actual <- datos_lm1_val$NRO_ACCID
lm1_val_mse <- MSE(predicted, actual) # MSE
lm1_val_mae <- MAE(predicted, actual) # MAE
lm1_val_r2 <- R2_Score(predicted, actual) # R2
sprintf("MSE: %f, MAE: %f, R2: %f", lm1_val_mse, lm1_val_mae, lm1_val_r2)
mae_tr = lm1_tr_mae
mae_vl = lm1_val_mae
print(mae_variation(mae_tr, mae_val))
La variación entre el MAE de entrenamiento y validación fue mínima, de tan solo -0.75 %; este dato nos ayuda a estar muy seguros de que no hay sobre entrenamiento. Con este modelo también conseguimos el MAE más pequeño de todos, cercano a 1, y el R2 cuadrado sigue siendo bueno, superior al 70%. Por tanto, concluimos que este es el mejor modelo para predecir, según nuestro criterio de éxito.
View(accidentes_gravedad)
View(bd_final)
accidentes_gravedad <- bd_final %>%
group_by(CLASE) %>%
summarise(numero_de_accidentes = n())
ggplot(data = accidentes_gravedad, aes(fill = CLASE, x = CLASE, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,150000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
ggplot(data = accidentes_gravedad, aes(fill = CLASE, x = CLASE, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,10000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
ggplot(data = accidentes_gravedad, aes(fill = CLASE, x = CLASE, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,15000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
ggplot(data = accidentes_gravedad, aes(fill = CLASE, x = CLASE, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,1000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
ggplot(data = accidentes_gravedad, aes(fill = CLASE, x = CLASE, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,100000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
ggplot(data = accidentes_gravedad, aes(fill = CLASE, x = CLASE, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,1000000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
ggplot(data = accidentes_gravedad, aes(fill = CLASE, x = CLASE, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,170000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
accidentes_gravedad <- bd_final %>%
group_by(GRAVEDAD) %>%
summarise(numero_de_accidentes = n())
ggplot(data = accidentes_gravedad, aes(fill = GRAVEDAD, x = GRAVEDAD, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,150000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
accidentes_clase <- bd_final %>%
group_by(CLASE) %>%
summarise(numero_de_accidentes = n())
ggplot(data = accidentes_clase, aes(fill = CLASE, x = CLASE, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,150000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
ggplot(data = accidentes_clase, aes(fill = CLASE, x = CLASE, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,170000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
accidentes_gravedad <- bd_final %>%
group_by(GRAVEDAD) %>%
summarise(numero_de_accidentes = n())
ggplot(data = accidentes_gravedad, aes(fill = GRAVEDAD, x = GRAVEDAD, y = numero_de_accidentes)) +
geom_bar(stat = "identity") +
geom_text(aes(y = numero_de_accidentes, label = numero_de_accidentes), vjust = -0.5) +
xlab("Gravedad") +
ylab("Número de acccidentes") +
ggtitle("Número de accidentes por gravedad") +
ylim(c(0,150000))+
theme(plot.title = element_text(hjust = 0.5),legend.position = "none")
